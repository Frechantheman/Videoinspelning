<!DOCTYPE html>
<html lang="sv">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Videoinspelning</title>
</head>
<body style="font-family: sans-serif; text-align: center; padding: 20px;">

  <h2>🎥 Tryck för att spela in</h2>

  <video id="preview" autoplay muted playsinline style="display: none; width: 100%; max-width: 500px; margin-bottom: 10px;"></video>

  <p id="timerDisplay" style="font-weight: bold;"></p>

  <button id="startBtn">Starta inspelning</button>
  <button id="stopBtn" disabled>Stoppa & spara</button>
  <br><br>
  <a id="downloadLink" style="display: none;"></a>

  <script>
    let mediaRecorder;
    let recordedChunks = [];
    let stream;
    let timerInterval;
    let seconds = 0;

    const preview = document.getElementById("preview");
    const startBtn = document.getElementById("startBtn");
    const stopBtn = document.getElementById("stopBtn");
    const downloadLink = document.getElementById("downloadLink");
    const timerDisplay = document.getElementById("timerDisplay");

    async function setupCamera() {
      stream = await navigator.mediaDevices.getUserMedia({
        video: { facingMode: { exact: "environment" } },
        audio: true
      });
      preview.srcObject = stream;
    }

    startBtn.onclick = async () => {
      startBtn.disabled = true;
      stopBtn.disabled = false;
      recordedChunks = [];
      seconds = 0;
      timerDisplay.textContent = "";

      await setupCamera();

      preview.style.display = "block"; // Visa när vi börjar spela in

      mediaRecorder = new MediaRecorder(stream);
      mediaRecorder.ondataavailable = e => {
        if (e.data.size > 0) recordedChunks.push(e.data);
      };

      mediaRecorder.onstop = () => {
        clearInterval(timerInterval);
        timerDisplay.textContent = "";
        preview.style.display = "none";

        const blob = new Blob(recordedChunks, { type: "video/webm" });
        const url = URL.createObjectURL(blob);
        downloadLink.href = url;
        downloadLink.download = "inspelning.webm";
        downloadLink.style.display = "block";
        downloadLink.textContent = "⬇️ Ladda ner din video";
      };

      mediaRecorder.start();

      timerInterval = setInterval(() => {
        seconds++;
        timerDisplay.textContent = `⏱️ ${seconds} sekunder`;
      }, 1000);
    };

    stopBtn.onclick = () => {
      stopBtn.disabled = true;
      startBtn.disabled = false;
      mediaRecorder.stop();
      stream.getTracks().forEach(track => track.stop()); // Stoppa kameran
    };
  </script>
</body>
</html>
